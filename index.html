<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Keuangan RESIK 2024-2025</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, rgba(59, 130, 246, 0.3), transparent),
                radial-gradient(2px 2px at 60% 70%, rgba(16, 185, 129, 0.3), transparent),
                radial-gradient(1px 1px at 50% 50%, rgba(139, 92, 246, 0.3), transparent),
                radial-gradient(1px 1px at 80% 10%, rgba(245, 158, 11, 0.3), transparent),
                radial-gradient(2px 2px at 90% 60%, rgba(236, 72, 153, 0.3), transparent);
            background-size: 200% 200%;
            animation: particleFloat 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes particleFloat {

            0%,
            100% {
                transform: translate(0, 0);
                opacity: 0.5;
            }

            50% {
                transform: translate(50px, 50px);
                opacity: 0.8;
            }
        }

        .container {
            position: relative;
            z-index: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.85) rotateX(10deg);
            }

            to {
                opacity: 1;
                transform: scale(1) rotateX(0deg);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }

            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        h1 {
            background: linear-gradient(90deg, #60a5fa, #a78bfa, #60a5fa);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
            text-shadow: 0 0 30px rgba(96, 165, 250, 0.5);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .scale-in {
            animation: scaleIn 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .stat-card {
            animation: fadeIn 0.6s ease-out forwards;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.8), rgba(17, 24, 39, 0.9));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
        }

        .stat-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .stat-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .stat-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .stat-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .stat-card svg {
            filter: drop-shadow(0 0 8px currentColor);
            transition: all 0.3s ease;
        }

        .stat-card:hover svg {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 15px currentColor);
        }

        .stat-card .p-3 {
            animation: float 3s ease-in-out infinite;
        }

        .stat-card:nth-child(1) .p-3 {
            animation-delay: 0s;
        }

        .stat-card:nth-child(2) .p-3 {
            animation-delay: 0.5s;
        }

        .stat-card:nth-child(3) .p-3 {
            animation-delay: 1s;
        }

        .stat-card:nth-child(4) .p-3 {
            animation-delay: 1.5s;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #60a5fa, #a78bfa);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .btn-filter {
            background: linear-gradient(135deg, rgba(55, 65, 81, 0.8), rgba(31, 41, 55, 0.9));
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-filter::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-filter:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-filter.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: rgba(96, 165, 250, 0.8);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }

        .chart-glow {
            position: relative;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.6), rgba(17, 24, 39, 0.8));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.4s ease;
        }

        .chart-glow::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 1rem;
            padding: 2px;
            background: linear-gradient(45deg,
                    rgba(59, 130, 246, 0.5),
                    rgba(139, 92, 246, 0.5),
                    rgba(236, 72, 153, 0.5),
                    rgba(59, 130, 246, 0.5));
            background-size: 300% 300%;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s;
            animation: gradientShift 3s ease infinite;
        }

        .chart-glow:hover::before {
            opacity: 1;
        }

        .chart-glow:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.3);
        }

        .legend-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 2px solid transparent;
        }

        .legend-item:hover {
            transform: translateX(8px);
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.15), transparent);
            border-left-color: rgba(59, 130, 246, 0.8);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        table {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.5), rgba(17, 24, 39, 0.7));
            backdrop-filter: blur(10px);
        }

        tbody tr {
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), transparent);
            transform: translateX(5px);
            box-shadow: -3px 0 0 rgba(59, 130, 246, 0.5);
        }

        .text-transparent {
            text-shadow: 0 0 10px currentColor;
        }

        canvas {
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.2));
        }
    </style>
</head>

<body class="text-gray-100 p-4 md:p-8">

    <div class="container mx-auto max-w-7xl">

        <h1 class="text-2xl md:text-3xl font-bold mb-2 text-center fade-in" style="animation-delay: 0s;">
            Laporan Keuangan RESIK 2024-2025
        </h1>
        <p class="text-gray-400 text-center mb-8 fade-in text-sm md:text-base" style="animation-delay: 0.1s;">
            Periode Oktober 2024 - November 2025
        </p>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

            <div class="stat-card p-6 rounded-lg shadow-xl opacity-0">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-600 rounded-full">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                            </path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Total Saldo Akhir</p>
                        <p class="text-2xl font-bold" id="saldo-resik">Rp 0</p>
                    </div>
                </div>
            </div>

            <div class="stat-card p-6 rounded-lg shadow-xl opacity-0">
                <div class="flex items-center">
                    <div class="p-3 bg-green-600 rounded-full">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                            </path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Jumlah Transaksi</p>
                        <p class="text-2xl font-bold" id="total-transaksi">0</p>
                    </div>
                </div>
            </div>

            <div class="stat-card p-6 rounded-lg shadow-xl opacity-0">
                <div class="flex items-center">
                    <div class="p-3 bg-yellow-500 rounded-full">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Total Pemasukan</p>
                        <p class="text-2xl font-bold" id="total-pemasukan">Rp 0</p>
                    </div>
                </div>
            </div>

            <div class="stat-card p-6 rounded-lg shadow-xl opacity-0">
                <div class="flex items-center">
                    <div class="p-3 bg-red-600 rounded-full">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 17h8m0 0v-8m0 8l-8-8-4 4-6-6"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Total Pengeluaran</p>
                        <p class="text-2xl font-bold" id="total-pengeluaran">Rp 0</p>
                    </div>
                </div>
            </div>

        </div>

        <div class="chart-glow rounded-lg shadow-xl p-6 mb-8 fade-in" style="animation-delay: 0.5s;">
            <h2 class="text-xl font-semibold mb-6 text-center">Grafik Arus Kas Bulanan</h2>
            <div class="relative h-80 md:h-96">
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">

            <div class="lg:col-span-1 flex flex-col gap-6 md:gap-8">
                <div class="chart-glow rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 scale-in opacity-0"
                    style="animation-delay: 0.6s;">
                    <div class="flex items-center justify-between mb-4 md:mb-6">
                        <h2
                            class="text-base sm:text-lg md:text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-500">
                            Kategori Pemasukan</h2>
                        <div class="p-1.5 md:p-2 bg-green-500/10 rounded-lg flex-shrink-0">
                            <svg class="w-4 h-4 md:w-5 md:h-5 text-green-400" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
                        <div class="relative flex-shrink-0" style="width: 180px; height: 180px;">
                            <canvas id="incomeChart"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <p class="text-2xl sm:text-3xl font-bold text-green-400" id="income-total-percent">100%
                                </p>
                                <p class="text-[10px] sm:text-xs text-gray-400 font-medium mt-1">TOTAL</p>
                            </div>
                        </div>

                        <div id="income-legend" class="flex-1 space-y-2 min-w-0 w-full sm:w-auto"></div>
                    </div>
                </div>

                <div class="chart-glow rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 scale-in opacity-0"
                    style="animation-delay: 0.7s;">
                    <div class="flex items-center justify-between mb-4 md:mb-6">
                        <h2
                            class="text-base sm:text-lg md:text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500">
                            Kategori Pengeluaran</h2>
                        <div class="p-1.5 md:p-2 bg-red-500/10 rounded-lg flex-shrink-0">
                            <svg class="w-4 h-4 md:w-5 md:h-5 text-red-400" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 17h8m0 0v-8m0 8l-8-8-4 4-6-6"></path>
                            </svg>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
                        <div class="relative flex-shrink-0" style="width: 180px; height: 180px;">
                            <canvas id="expenseChart"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <p class="text-2xl sm:text-3xl font-bold text-orange-400" id="expense-total-percent">
                                    100%</p>
                                <p class="text-[10px] sm:text-xs text-gray-400 font-medium mt-1">TOTAL</p>
                            </div>
                            <p id="no-expense-msg"
                                class="absolute inset-0 flex items-center justify-center text-gray-500 text-sm hidden">
                                Tidak ada pengeluaran</p>
                        </div>

                        <div id="expense-legend" class="flex-1 space-y-2 min-w-0 w-full sm:w-auto"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 chart-glow rounded-lg shadow-xl overflow-hidden fade-in"
                style="animation-delay: 0.8s;">
                <div class="p-4 md:p-6 flex flex-col md:flex-row justify-between items-center border-b border-gray-700">
                    <h2 class="text-xl font-semibold mb-4 md:mb-0">Detail Transaksi</h2>
                    <div class="flex space-x-2">
                        <button id="filter-all"
                            class="btn-filter active px-4 py-2 rounded-lg text-sm font-medium">Semua</button>
                        <button id="filter-pemasukan"
                            class="btn-filter px-4 py-2 rounded-lg text-sm font-medium">Pemasukan</button>
                        <button id="filter-pengeluaran"
                            class="btn-filter px-4 py-2 rounded-lg text-sm font-medium">Pengeluaran</button>
                    </div>
                </div>

                <div class="overflow-x-auto max-h-[700px]">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-800 sticky top-0 z-10">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    No</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    Tgl</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    Uraian</th>
                                <th
                                    class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    Pemasukan</th>
                                <th
                                    class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    Pengeluaran</th>
                                <th
                                    class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">
                                    Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-table-body" class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        const rawData = [
            { no: 1, tgl: "18/10/2024", uraian: "Penjualan galon bekas", pemasukan: "20,000", pengeluaran: "0", saldo: "20,000" },
            { no: 2, tgl: "26/02/2025", uraian: "Penjualan ke pengepul 1", pemasukan: "96,000", pengeluaran: "0", saldo: "96,000" },
            { no: 3, tgl: "26/02/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "124,140", pengeluaran: "0", saldo: "220,140" },
            { no: 4, tgl: "14/03/2025", uraian: "Penjualan botol mineral bekas", pemasukan: "5,000", pengeluaran: "0", saldo: "225,140" },
            { no: 5, tgl: "15/03/2025", uraian: "Penjualan ke pengepul 1", pemasukan: "696,400", pengeluaran: "0", saldo: "921,540" },
            { no: 6, tgl: "15/03/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "260,225", pengeluaran: "0", saldo: "1,181,765" },
            { no: 7, tgl: "17/03/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "30,150", pengeluaran: "0", saldo: "1,211,915" },
            { no: 8, tgl: "17/03/2025", uraian: "Penjualan accu bekas", pemasukan: "15,000", pengeluaran: "0", saldo: "1,226,915" },
            { no: 9, tgl: "17/03/2025", uraian: "Taawun Cinta Guru", pemasukan: "0", pengeluaran: "622,500", saldo: "604,415" },
            { no: 10, tgl: "24/05/2025", uraian: "Penjualan ke pengepul 1", pemasukan: "354,500", pengeluaran: "0", saldo: "958,915" },
            { no: 11, tgl: "24/05/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "324,905", pengeluaran: "0", saldo: "1,283,820" },
            { no: 12, tgl: "24/05/2025", uraian: "Pembelian BBM", pemasukan: "0", pengeluaran: "50,000", saldo: "1,233,820" },
            { no: 13, tgl: "24/05/2025", uraian: "Jasa pembersihan tempat sampah", pemasukan: "0", pengeluaran: "50,000", saldo: "1,183,820" },
            { no: 14, tgl: "25/05/2025", uraian: "Cinta guru", pemasukan: "0", pengeluaran: "339,703", saldo: "844,118" },
            { no: 15, tgl: "20/07/2025", uraian: "Cetak baner dan poster", pemasukan: "0", pengeluaran: "170,000", saldo: "674,118" },
            { no: 16, tgl: "20/07/2025", uraian: "Cetak baner dan poster", pemasukan: "0", pengeluaran: "165,000", saldo: "509,118" },
            { no: 17, tgl: "02/08/2025", uraian: "Penjualan ke pengepul 1", pemasukan: "331,885", pengeluaran: "0", saldo: "841,003" },
            { no: 18, tgl: "02/08/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "380,650", pengeluaran: "0", saldo: "1,221,653" },
            { no: 19, tgl: "02/08/2025", uraian: "Penjualan galon bekas", pemasukan: "10,000", pengeluaran: "0", saldo: "1,231,653" },
            { no: 20, tgl: "02/08/2025", uraian: "Cinta guru", pemasukan: "0", pengeluaran: "356,268", saldo: "875,385" },
            { no: 21, tgl: "02/08/2025", uraian: "Pembelian BBM", pemasukan: "0", pengeluaran: "50,000", saldo: "825,385" },
            { no: 22, tgl: "22/08/2025", uraian: "Penjualan kipas angin bekas", pemasukan: "10,000", pengeluaran: "0", saldo: "835,385" },
            { no: 23, tgl: "24/08/2025", uraian: "Pembelian cat (Emco 52) 1/2 kg", pemasukan: "0", pengeluaran: "42,500", saldo: "792,885" },
            { no: 24, tgl: "24/08/2025", uraian: "Pembelian cat (Emco 66) 1/2 kg", pemasukan: "0", pengeluaran: "48,100", saldo: "744,785" },
            { no: 25, tgl: "24/08/2025", uraian: "Pembelian kuas 2 buah, @6,500", pemasukan: "0", pengeluaran: "13,000", saldo: "731,785" },
            { no: 26, tgl: "24/08/2025", uraian: "Pembelian thiner 3 buah, @19,000", pemasukan: "0", pengeluaran: "57,000", saldo: "674,785" },
            { no: 27, tgl: "24/08/2025", uraian: "Pembelian pipa wastafel", pemasukan: "0", pengeluaran: "32,000", saldo: "642,785" },
            { no: 28, tgl: "24/08/2025", uraian: "Pembelian tempat sabun 8 buah@4,250", pemasukan: "0", pengeluaran: "34,000", saldo: "608,785" },
            { no: 29, tgl: "24/08/2025", uraian: "Pembelian jemuran portable", pemasukan: "0", pengeluaran: "260,000", saldo: "348,785" },
            { no: 30, tgl: "26/09/2025", uraian: "Penjualan alat electronik bekas", pemasukan: "15,000", pengeluaran: "0", saldo: "363,785" },
            { no: 31, tgl: "26/09/2025", uraian: "Pembuatan stiker grafrac", pemasukan: "0", pengeluaran: "140,000", saldo: "223,785" },
            { no: 32, tgl: "23/10/2025", uraian: "Penjualan rongsok dari muhsinin", pemasukan: "160,000", pengeluaran: "0", saldo: "383,785" },
            { no: 33, tgl: "24/10/2025", uraian: "Penjualan galon bekas", pemasukan: "15,200", pengeluaran: "0", saldo: "15,200" },
            { no: 34, tgl: "24/10/2025", uraian: "Penjualan ke pengepul", pemasukan: "822,500", pengeluaran: "0", saldo: "1.206.285" },
            { no: 35, tgl: "24/10/2025", uraian: "Cinta guru", pemasukan: "0", pengeluaran: "498,850", saldo: "707,435" },
            { no: 36, tgl: "19/11/2025", uraian: "Penjualan minyak jlantah", pemasukan: "275,000", pengeluaran: "0", saldo: "982,435" },
            { no: 37, tgl: "28/11/2025", uraian: "Penjualan ke pengepul 1", pemasukan: "950,000", pengeluaran: "0", saldo: "1.932,435" },
            { no: 38, tgl: "28/11/2025", uraian: "Penjualan ke pengepul 2", pemasukan: "200,000", pengeluaran: "0", saldo: "2.132,435" },
            { no: 39, tgl: "28/11/2025", uraian: "Penjualan botol bekas dari muhsinin", pemasukan: "10,000", pengeluaran: "0", saldo: "2.142,435" },
            { no: 40, tgl: "29/11/2025", uraian: "Kontribusi untuk program November ceria", pemasukan: "0", pengeluaran: "1,435,000", saldo: "707,435" }
        ];

        function parseCurrency(str) {
            if (typeof str !== 'string' || !str) return 0;
            return parseInt(str.replace(/\./g, '').replace(/,/g, ''), 10) || 0;
        }

        function formatCurrency(num) {
            return "Rp " + new Intl.NumberFormat('id-ID').format(num);
        }

        function animateNumber(element, target, duration = 1500) {
            let start = 0;
            const startTime = performance.now();
            function update(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                let current = Math.floor(progress * target);
                element.textContent = target === rawData.length ? current : formatCurrency(current);
                if (progress < 1) requestAnimationFrame(update);
                else element.textContent = target === rawData.length ? target : formatCurrency(target);
            }
            requestAnimationFrame(update);
        }

        function parseCustomDate(dateStr) {
            if (!dateStr || dateStr.length < 8) return null;
            const parts = dateStr.split('/');
            if (parts.length !== 3) return null;
            const [day, month, year] = parts;
            return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        }

        let processedData = [];
        let totalPemasukanGlobal = 0;
        let totalPengeluaranGlobal = 0;
        let lastSaldo = 0;

        document.addEventListener('DOMContentLoaded', () => {
            processedData = rawData.map(item => {
                const pemasukan = parseCurrency(item.pemasukan);
                const pengeluaran = parseCurrency(item.pengeluaran);
                const saldo = parseCurrency(item.saldo);

                totalPemasukanGlobal += pemasukan;
                totalPengeluaranGlobal += pengeluaran;

                return { ...item, pemasukan, pengeluaran, saldo, isoDate: parseCustomDate(item.tgl) };
            });

            lastSaldo = processedData[processedData.length - 1].saldo;

            animateNumber(document.getElementById('saldo-resik'), lastSaldo);
            animateNumber(document.getElementById('total-transaksi'), rawData.length);
            animateNumber(document.getElementById('total-pemasukan'), totalPemasukanGlobal);
            animateNumber(document.getElementById('total-pengeluaran'), totalPengeluaranGlobal);

            populateTable('all');

            const filterButtons = document.querySelectorAll('.btn-filter');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    populateTable(e.target.id.replace('filter-', ''));
                });
            });

            generateBarChart();
            generateDonutCharts();
        });

        function populateTable(filter) {
            const tbody = document.getElementById('transaction-table-body');
            tbody.innerHTML = '';

            let data = processedData;
            if (filter === 'pemasukan') data = processedData.filter(d => d.pemasukan > 0);
            if (filter === 'pengeluaran') data = processedData.filter(d => d.pengeluaran > 0);

            data.sort((a, b) => a.no - b.no);

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center text-gray-400">Tidak ada data transaksi ${filter}.</td></tr>`;
                return;
            }

            data.forEach((item, idx) => {
                const tr = document.createElement('tr');
                tr.className = 'fade-in';
                tr.style.animationDelay = `${idx * 0.02}s`;
                tr.innerHTML = `
                    <td class="px-6 py-4 text-sm text-gray-300">${item.no}</td>
                    <td class="px-6 py-4 text-sm text-gray-300 whitespace-nowrap">${item.tgl}</td>
                    <td class="px-6 py-4 text-sm font-medium text-white">${item.uraian}</td>
                    <td class="px-6 py-4 text-sm text-green-400 text-right">${item.pemasukan > 0 ? formatCurrency(item.pemasukan) : '-'}</td>
                    <td class="px-6 py-4 text-sm text-red-400 text-right">${item.pengeluaran > 0 ? formatCurrency(item.pengeluaran) : '-'}</td>
                    <td class="px-6 py-4 text-sm text-gray-300 text-right font-mono">${formatCurrency(item.saldo)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function generateBarChart() {
            const grouped = {};
            processedData.forEach(d => {
                if (!d.isoDate) return;
                const monthKey = d.isoDate.substring(0, 7);
                if (!grouped[monthKey]) grouped[monthKey] = { in: 0, out: 0 };
                grouped[monthKey].in += d.pemasukan;
                grouped[monthKey].out += d.pengeluaran;
            });

            const sortedKeys = Object.keys(grouped).sort();
            const labels = sortedKeys.map(k => {
                const [y, m] = k.split('-');
                const date = new Date(parseInt(y), parseInt(m) - 1, 1);
                return date.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
            });

            new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Pemasukan', data: sortedKeys.map(k => grouped[k].in), backgroundColor: '#10B981', borderRadius: 4 },
                        { label: 'Pengeluaran', data: sortedKeys.map(k => grouped[k].out), backgroundColor: '#F59E0B', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#D1D5DB' } } },
                    scales: {
                        y: { ticks: { color: '#9CA3AF', callback: val => 'Rp ' + (val / 1000000).toFixed(1) + 'Jt' }, grid: { color: '#374151' } },
                        x: { ticks: { color: '#9CA3AF' }, grid: { display: false } }
                    }
                }
            });
        }

        function createLegend(containerId, labels, colors, values) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const total = values.reduce((a, b) => a + b, 0);

            labels.forEach((label, idx) => {
                const percentage = ((values[idx] / total) * 100).toFixed(1);
                const item = document.createElement('div');
                item.className = 'legend-item flex items-center justify-between p-2 rounded-lg cursor-pointer';
                item.innerHTML = `
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                        <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: ${colors[idx]}"></div>
                        <span class="text-xs sm:text-sm text-gray-300 truncate">${label}</span>
                    </div>
                    <span class="text-xs sm:text-sm font-semibold text-white ml-2 flex-shrink-0">${percentage}%</span>
                `;
                container.appendChild(item);
            });
        }

        function generateDonutCharts() {
            const incomeCats = {};
            processedData.forEach(d => {
                if (d.pemasukan > 0) {
                    const desc = d.uraian.toLowerCase();
                    let cat = 'Lain-lain';
                    if (desc.includes('penjualan ke pengepul')) cat = 'Jual Rongsok';
                    else if (desc.includes('penjualan galon bekas')) cat = 'Galon Bekas';
                    else if (desc.includes('accu') || desc.includes('kipas') || desc.includes('elektronik') || desc.includes('botol')) cat = 'Barang Bekas';
                    else if (desc.includes('minyak jlantah')) cat = 'Minyak Jelantah';
                    else if (desc.includes('rongsok dari muhsinin')) cat = 'Donasi';

                    incomeCats[cat] = (incomeCats[cat] || 0) + d.pemasukan;
                }
            });

            const incomeColors = [
                'rgba(16, 185, 129, 0.9)', 'rgba(59, 130, 246, 0.9)', 'rgba(245, 158, 11, 0.9)',
                'rgba(139, 92, 246, 0.9)', 'rgba(239, 68, 68, 0.9)', 'rgba(6, 182, 212, 0.9)'
            ];

            createLegend('income-legend', Object.keys(incomeCats), incomeColors, Object.values(incomeCats));
            renderDonut('incomeChart', incomeCats, incomeColors);

            const expenseCats = {};
            processedData.forEach(d => {
                if (d.pengeluaran > 0) {
                    const desc = d.uraian.toLowerCase();
                    let cat = 'Lain-lain';
                    if (desc.includes('cinta guru') || desc.includes('taawun')) cat = 'Cinta Guru';
                    else if (desc.includes('bbm')) cat = 'BBM';
                    else if (desc.includes('cetak baner') || desc.includes('stiker')) cat = 'Promosi';
                    else if (desc.includes('cat') || desc.includes('kuas') || desc.includes('thiner') || desc.includes('wastafel') || desc.includes('tempat sabun')) cat = 'Perbaikan';
                    else if (desc.includes('pembersihan tempat sampah')) cat = 'Jasa';
                    else if (desc.includes('jemuran')) cat = 'Aset';
                    else if (desc.includes('november ceria')) cat = 'Program';

                    expenseCats[cat] = (expenseCats[cat] || 0) + d.pengeluaran;
                }
            });

            const expenseColors = [
                'rgba(239, 68, 68, 0.9)', 'rgba(252, 211, 77, 0.9)', 'rgba(249, 115, 22, 0.9)',
                'rgba(220, 38, 38, 0.9)', 'rgba(99, 102, 241, 0.9)', 'rgba(236, 72, 153, 0.9)'
            ];

            if (Object.keys(expenseCats).length === 0) {
                document.getElementById('no-expense-msg').classList.remove('hidden');
            } else {
                document.getElementById('no-expense-msg').classList.add('hidden');
                createLegend('expense-legend', Object.keys(expenseCats), expenseColors, Object.values(expenseCats));
                renderDonut('expenseChart', expenseCats, expenseColors);
            }
        }

        function renderDonut(id, dataObj, colors) {
            new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(dataObj),
                    datasets: [{
                        data: Object.values(dataObj),
                        backgroundColor: colors,
                        borderColor: '#1f2937',
                        borderWidth: 3,
                        hoverBorderWidth: 5,
                        hoverBorderColor: '#fff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#D1D5DB',
                            borderColor: '#374151',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        intersect: true
                    }
                }
            });
        }
    </script>
</body>

</html>